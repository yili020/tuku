<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬äºŒé˜¶æ®µæµ‹è¯• - å°ç™½å­¦</title>
    <link rel="stylesheet" href="css/base.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        .test-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
        }
        .test-section h3 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }
        .test-button {
            margin-right: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }
        .test-result {
            background: var(--bg-secondary);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-md);
            font-family: 'Consolas', monospace;
            font-size: var(--font-sm);
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-result.success {
            border-left: 4px solid var(--success-color);
        }
        .test-result.error {
            border-left: 4px solid var(--danger-color);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>å°ç™½å­¦ - ç¬¬äºŒé˜¶æ®µæµ‹è¯•</h1>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">è¿”å›é¦–é¡µ</a>
            </nav>
        </div>
    </header>

    <main class="test-container">
        <div class="test-section">
            <h3>ğŸ“ JSONæ•°æ®ç»“æ„æµ‹è¯•</h3>
            <button class="btn-primary test-button" onclick="testJSONStructure()">æµ‹è¯•JSONç»“æ„åˆ›å»º</button>
            <button class="btn-primary test-button" onclick="testValidation()">æµ‹è¯•æ•°æ®éªŒè¯</button>
            <div id="jsonStructureResult" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ’¾ localStorageæ•°æ®ç®¡ç†æµ‹è¯•</h3>
            <button class="btn-primary test-button" onclick="testLoadExample()">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
            <button class="btn-primary test-button" onclick="testSaveExample()">ä¿å­˜ç¤ºä¾‹æ•°æ®</button>
            <button class="btn-primary test-button" onclick="testGetExamples()">è·å–æ‰€æœ‰ç¤ºä¾‹</button>
            <div id="storageResult" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¨ åŒºå—æ¸²æŸ“æµ‹è¯•</h3>
            <button class="btn-primary test-button" onclick="testRenderCodeBlock()">æ¸²æŸ“ä»£ç å—</button>
            <button class="btn-primary test-button" onclick="testRenderDescription()">æ¸²æŸ“æè¿°å—</button>
            <button class="btn-primary test-button" onclick="testRenderHtmlContainer()">æ¸²æŸ“HTMLå®¹å™¨</button>
            <div id="renderResult" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— å®Œæ•´æµç¨‹æµ‹è¯•</h3>
            <button class="btn-success test-button" onclick="testFullFlow()">è¿è¡Œå®Œæ•´æµç¨‹æµ‹è¯•</button>
            <button class="btn-secondary test-button" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <div id="fullFlowResult" class="test-result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸš€ å¿«é€Ÿè·³è½¬</h3>
            <button class="btn-primary test-button" onclick="goToHome()">é¦–é¡µ</button>
            <button class="btn-primary test-button" onclick="goToLearning()">å­¦ä¹ é¡µé¢</button>
            <button class="btn-primary test-button" onclick="goToCreator()">åˆ›ä½œè€…ä¸­å¿ƒ</button>
        </div>
    </main>

    <script src="js/common.js"></script>
    <script src="js/json-structure.js"></script>
    <script src="js/block-renderer.js"></script>
    <script>
        const renderer = new BlockRenderer();

        function showResult(elementId, content, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'test-result ' + (isSuccess ? 'success' : 'error');
            element.textContent = content;
        }

        function testJSONStructure() {
            try {
                const exampleId = CommonUtils.generateExampleId();
                const structure = JSONStructure.createEmptyStructure(exampleId, {
                    title: 'æµ‹è¯•ç¤ºä¾‹',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¤ºä¾‹'
                });
                
                const bigStep = JSONStructure.createBigStep('ç¬¬ä¸€æ­¥', 'è¿™æ˜¯ç¬¬ä¸€ä¸ªå¤§æ­¥éª¤');
                const smallStep = JSONStructure.createSmallStep('ç¬¬ä¸€ä¸ªæ¦‚å¿µ', 'å­¦ä¹ ç¬¬ä¸€ä¸ªæ¦‚å¿µ');
                const codeBlock = JSONStructure.createBlock('code-block', {
                    language: 'html',
                    content: '<h1>Hello World</h1>'
                });
                
                smallStep.blocks.rightArea.push(codeBlock);
                bigStep.smallSteps.push(smallStep);
                structure.bigSteps.push(bigStep);
                
                showResult('jsonStructureResult', 'âœ… JSONç»“æ„åˆ›å»ºæˆåŠŸï¼\n\n' + JSON.stringify(structure, null, 2));
            } catch (error) {
                showResult('jsonStructureResult', 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message, false);
            }
        }

        function testValidation() {
            try {
                const validData = {
                    exampleId: 'test_001',
                    metadata: { title: 'æµ‹è¯•' },
                    bigSteps: [{
                        bigStepId: 'big_01',
                        title: 'æ­¥éª¤1',
                        smallSteps: [{
                            smallStepId: 'small_01',
                            title: 'æ¦‚å¿µ1',
                            blocks: { leftArea: [], rightArea: [] }
                        }]
                    }]
                };
                
                const result = JSONStructure.validateStructure(validData);
                
                showResult('jsonStructureResult', 
                    result.valid ? 
                    'âœ… æ•°æ®éªŒè¯é€šè¿‡ï¼' : 
                    'âŒ æ•°æ®éªŒè¯å¤±è´¥: ' + result.errors.join(', '),
                    result.valid
                );
            } catch (error) {
                showResult('jsonStructureResult', 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message, false);
            }
        }

        async function testLoadExample() {
            try {
                await CommonUtils.initializeExampleFromFile('data/examples/html-basic.json', true);
                showResult('storageResult', 'âœ… ç¤ºä¾‹æ•°æ®åŠ è½½æˆåŠŸï¼');
            } catch (error) {
                showResult('storageResult', 'âŒ åŠ è½½å¤±è´¥: ' + error.message, false);
            }
        }

        function testSaveExample() {
            try {
                const testData = {
                    exampleId: 'test_save_001',
                    metadata: { title: 'ä¿å­˜æµ‹è¯•ç¤ºä¾‹' },
                    bigSteps: []
                };
                
                CommonUtils.saveExampleData(testData.exampleId, testData);
                const retrieved = CommonUtils.getExampleData(testData.exampleId);
                
                showResult('storageResult', 
                    retrieved ? 
                    'âœ… æ•°æ®ä¿å­˜å¹¶è¯»å–æˆåŠŸï¼\n\n' + JSON.stringify(retrieved, null, 2) : 
                    'âŒ æ•°æ®è¯»å–å¤±è´¥',
                    !!retrieved
                );
            } catch (error) {
                showResult('storageResult', 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message, false);
            }
        }

        function testGetExamples() {
            try {
                const examples = CommonUtils.getAllExamples();
                showResult('storageResult', 
                    `âœ… æ‰¾åˆ° ${examples.length} ä¸ªç¤ºä¾‹\n\n` + 
                    JSON.stringify(examples, null, 2)
                );
            } catch (error) {
                showResult('storageResult', 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message, false);
            }
        }

        function testRenderCodeBlock() {
            try {
                const block = {
                    id: 'test_code_01',
                    type: 'code-block',
                    language: 'javascript',
                    content: 'console.log("Hello World");',
                    associations: []
                };
                
                const element = renderer.render(block);
                const container = document.getElementById('renderResult');
                container.innerHTML = '';
                container.appendChild(element);
                container.style.display = 'block';
                container.className = 'test-result success';
            } catch (error) {
                showResult('renderResult', 'âŒ æ¸²æŸ“å¤±è´¥: ' + error.message, false);
            }
        }

        function testRenderDescription() {
            try {
                const block = {
                    id: 'test_desc_01',
                    type: 'description',
                    content: '<h4>æè¿°æ ‡é¢˜</h4><p>è¿™æ˜¯ä¸€ä¸ªæè¿°å—çš„ç¤ºä¾‹</p>',
                    associations: []
                };
                
                const element = renderer.render(block);
                const container = document.getElementById('renderResult');
                container.innerHTML = '';
                container.appendChild(element);
                container.style.display = 'block';
                container.className = 'test-result success';
            } catch (error) {
                showResult('renderResult', 'âŒ æ¸²æŸ“å¤±è´¥: ' + error.message, false);
            }
        }

        function testRenderHtmlContainer() {
            try {
                const block = {
                    id: 'test_html_01',
                    type: 'html-container',
                    content: '<div style="padding: 20px; background: #4A90E2; color: white; border-radius: 8px;"><h3>HTMLå®¹å™¨æµ‹è¯•</h3><p>è¿™æ˜¯æ¸²æŸ“çš„HTMLå†…å®¹</p></div>',
                    associations: []
                };
                
                const element = renderer.render(block);
                const container = document.getElementById('renderResult');
                container.innerHTML = '';
                container.appendChild(element);
                container.style.display = 'block';
                container.className = 'test-result success';
            } catch (error) {
                showResult('renderResult', 'âŒ æ¸²æŸ“å¤±è´¥: ' + error.message, false);
            }
        }

        async function testFullFlow() {
            const results = [];
            
            try {
                // æµ‹è¯•1: åŠ è½½ç¤ºä¾‹æ•°æ®
                results.push('ğŸ“ æµ‹è¯•1: åŠ è½½ç¤ºä¾‹æ•°æ®...');
                await CommonUtils.initializeExampleFromFile('data/examples/html-basic.json', true);
                results.push('âœ… ç¤ºä¾‹æ•°æ®åŠ è½½æˆåŠŸ\n');
                
                // æµ‹è¯•2: è·å–ç¤ºä¾‹åˆ—è¡¨
                results.push('ğŸ“ æµ‹è¯•2: è·å–ç¤ºä¾‹åˆ—è¡¨...');
                const examples = CommonUtils.getPublishedExamples();
                results.push(`âœ… æ‰¾åˆ° ${examples.length} ä¸ªå·²å‘å¸ƒç¤ºä¾‹\n`);
                
                // æµ‹è¯•3: è¯»å–ç¤ºä¾‹æ•°æ®
                results.push('ğŸ“ æµ‹è¯•3: è¯»å–ç¤ºä¾‹æ•°æ®...');
                const exampleData = CommonUtils.getExampleData('ex_html_basic_001');
                if (exampleData) {
                    results.push(`âœ… æˆåŠŸè¯»å–ç¤ºä¾‹: ${exampleData.metadata.title}`);
                    results.push(`   - å¤§æ­¥éª¤æ•°: ${exampleData.bigSteps.length}`);
                    results.push(`   - ç¬¬ä¸€ä¸ªå¤§æ­¥éª¤æ ‡é¢˜: ${exampleData.bigSteps[0].title}\n`);
                } else {
                    results.push('âŒ è¯»å–ç¤ºä¾‹æ•°æ®å¤±è´¥\n');
                }
                
                // æµ‹è¯•4: æ¸²æŸ“åŒºå—
                results.push('ğŸ“ æµ‹è¯•4: æ¸²æŸ“åŒºå—...');
                const testBlock = {
                    id: 'test_block',
                    type: 'code-block',
                    language: 'html',
                    content: '<h1>æµ‹è¯•</h1>',
                    associations: []
                };
                const element = renderer.render(testBlock);
                results.push('âœ… åŒºå—æ¸²æŸ“æˆåŠŸ\n');
                
                // æµ‹è¯•5: JSONéªŒè¯
                results.push('ğŸ“ æµ‹è¯•5: JSONæ•°æ®éªŒè¯...');
                const validation = JSONStructure.validateStructure(exampleData);
                results.push(validation.valid ? 'âœ… æ•°æ®ç»“æ„éªŒè¯é€šè¿‡\n' : 'âŒ æ•°æ®ç»“æ„éªŒè¯å¤±è´¥\n');
                
                results.push('\nğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼');
                showResult('fullFlowResult', results.join('\n'));
            } catch (error) {
                results.push('\nâŒ æµ‹è¯•å¤±è´¥: ' + error.message);
                showResult('fullFlowResult', results.join('\n'), false);
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç¤ºä¾‹æ•°æ®å—ï¼Ÿ')) {
                localStorage.clear();
                CommonUtils.showMessage('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
                showResult('fullFlowResult', 'âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
            }
        }

        function goToHome() {
            window.location.href = 'index.html';
        }

        function goToLearning() {
            const examples = CommonUtils.getPublishedExamples();
            if (examples.length > 0) {
                window.location.href = `learning.html?exampleId=${examples[0].exampleId}`;
            } else {
                CommonUtils.showMessage('è¯·å…ˆåŠ è½½ç¤ºä¾‹æ•°æ®', 'warning');
            }
        }

        function goToCreator() {
            window.location.href = 'creator.html';
        }
    </script>
</body>
</html>
