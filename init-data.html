<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åˆå§‹åŒ– - å°ç™½å­¦</title>
    <link rel="stylesheet" href="css/base.css">
    <style>
        .init-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
        }
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
        .btn {
            padding: 12px 24px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #357abd;
        }
        .btn.secondary {
            background: #6c757d;
        }
        .btn.secondary:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="init-container">
        <h1>ğŸ“¦ æ•°æ®åˆå§‹åŒ–å·¥å…·</h1>
        <p>æ­¤é¡µé¢ç”¨äºåˆå§‹åŒ–å­¦ä¹ æ•°æ®åˆ°æµè§ˆå™¨å­˜å‚¨</p>
        
        <div id="status" class="status loading">
            æ­£åœ¨æ£€æŸ¥æ•°æ®çŠ¶æ€...
        </div>
        
        <div id="actions" style="margin-top: 20px; display: none;">
            <button class="btn" onclick="loadData()">ğŸ”„ åŠ è½½åŸºç¡€ç¤ºä¾‹æ•°æ®</button>
            <button class="btn" onclick="loadCodeLineDemo()" style="background: #8e44ad;">ğŸ”— åŠ è½½ä»£ç è¡Œè”åŠ¨æ¼”ç¤º</button>
            <button class="btn secondary" onclick="viewStorage()">ğŸ‘ï¸ æŸ¥çœ‹å­˜å‚¨æ•°æ®</button>
            <button class="btn" onclick="goToLearning()">ğŸ“š è¿›å…¥å­¦ä¹ é¡µé¢</button>
        </div>
        
        <div id="storage-info" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; display: none;">
            <h3>å­˜å‚¨ä¿¡æ¯ï¼š</h3>
            <pre id="storage-content" style="overflow: auto; max-height: 300px;"></pre>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const actionsEl = document.getElementById('actions');
        const storageInfoEl = document.getElementById('storage-info');
        const storageContentEl = document.getElementById('storage-content');

        // æ£€æŸ¥æ•°æ®çŠ¶æ€
        function checkDataStatus() {
            const examples = CommonUtils.getPublishedExamples();
            
            if (examples && examples.length > 0) {
                statusEl.className = 'status success';
                statusEl.innerHTML = `âœ… æ•°æ®å·²å­˜åœ¨ï¼æ‰¾åˆ° ${examples.length} ä¸ªç¤ºä¾‹<br>` +
                    examples.map(ex => `- ${ex.title} (ID: ${ex.exampleId})`).join('<br>');
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ æœªæ‰¾åˆ°æ•°æ®ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ è½½';
            }
            
            actionsEl.style.display = 'block';
        }

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        async function loadData() {
            statusEl.className = 'status loading';
            statusEl.textContent = 'æ­£åœ¨åŠ è½½ç¤ºä¾‹æ•°æ®...';
            
            try {
                await CommonUtils.initializeExampleFromFile('data/examples/html-basic.json', true);
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… æ•°æ®åŠ è½½æˆåŠŸï¼';
                setTimeout(checkDataStatus, 500);
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ åŠ è½½å¤±è´¥: ' + error.message;
            }
        }
        
        // åŠ è½½ä»£ç è¡Œè”åŠ¨æ¼”ç¤ºæ•°æ®
        async function loadCodeLineDemo() {
            statusEl.className = 'status loading';
            statusEl.textContent = 'æ­£åœ¨åŠ è½½ä»£ç è¡Œè”åŠ¨æ¼”ç¤ºæ•°æ®...';
            
            try {
                await CommonUtils.initializeExampleFromFile('data/examples/code-line-demo.json', true);
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… ä»£ç è¡Œè”åŠ¨æ¼”ç¤ºæ•°æ®åŠ è½½æˆåŠŸï¼';
                setTimeout(checkDataStatus, 500);
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ åŠ è½½å¤±è´¥: ' + error.message;
            }
        }

        // æŸ¥çœ‹å­˜å‚¨æ•°æ®
        function viewStorage() {
            const examples = CommonUtils.getPublishedExamples();
            if (examples && examples.length > 0) {
                const data = examples.map(ex => {
                    const fullData = CommonUtils.getExampleData(ex.exampleId);
                    return {
                        id: ex.exampleId,
                        title: ex.title,
                        bigSteps: fullData?.bigSteps?.length || 0,
                        totalSmallSteps: fullData?.bigSteps?.reduce((sum, big) => sum + (big.smallSteps?.length || 0), 0) || 0
                    };
                });
                storageContentEl.textContent = JSON.stringify(data, null, 2);
                storageInfoEl.style.display = 'block';
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°å­˜å‚¨çš„æ•°æ®');
            }
        }

        // è¿›å…¥å­¦ä¹ é¡µé¢
        function goToLearning() {
            const examples = CommonUtils.getPublishedExamples();
            if (examples && examples.length > 0) {
                const firstExample = examples[0];
                window.location.href = `learning.html?exampleId=${firstExample.exampleId}`;
            } else {
                alert('è¯·å…ˆåŠ è½½ç¤ºä¾‹æ•°æ®ï¼');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.addEventListener('DOMContentLoaded', checkDataStatus);
    </script>
</body>
</html>
